#!/bin/bash

# --- Configuration ---
# An array of websites to check
WEBSITES=("google.com" "github.com" "your-website-link.com" "127.0.0.1")
LOG_FILE="/var/log/apache2/access.log" # Example path for a web log
THRESHOLD=10                           # Number of errors before flagging an IP

echo "--- SITE CONNECTIVITY CHECK ---"

# 1. Loop through the Array
for site in "${WEBSITES[@]}"; do
    # -c 1 (send 1 packet), -W 2 (wait 2 seconds)
    if ping -c 1 -W 2 "$site" > /dev/null 2>&1; then
        echo "[ONLINE] $site is reachable."
    else
        echo "[OFFLINE] $site is down! Check connection."
    fi
done

echo ""
echo "--- SCANNING FOR SECURITY THREATS ---"

# 2. Check if log file exists
if [ ! -f "$LOG_FILE" ]; then
    echo "Log file $LOG_FILE not found. Skipping log analysis."
    exit 1
fi

# 3. Find IPs with high 404 error counts
# awk grabs the IP (column 1) and status code (column 9)
# sort/uniq counts occurrences
echo "The following IPs have more than $THRESHOLD errors:"



BAD_IPS=$(awk '$9 == 404 {print $1}' "$LOG_FILE" | sort | uniq -c | sort -nr)

while read -r line; do
    count=$(echo "$line" | awk '{print $1}')
    ip=$(echo "$line" | awk '{print $2}')

    if [ "$count" -gt "$THRESHOLD" ]; then
        echo "ALERT: IP $ip has $count errors. Potential bot/attacker."
    fi
done <<< "$BAD_IPS"

echo "-----------------------------------"
echo "Check complete at $(date)"
